link(rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css')
script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js')
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.json2html/1.2.0/jquery.json2html.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/javascripts/json2html.js"></script> 
style.
  body {
  margin:0;
  }
  
  .invalid-input{
    background-color: red;
  }
  h1 {
  font-family: 'Lato', sans-serif;
  font-weight:300;
  letter-spacing: 2px;
  font-size:48px;
  }
  p {
  font-family: 'Lato', sans-serif;
  letter-spacing: 1px;
  font-size:14px;
  color: #333333;
  }
  .header {
  position:relative;
  text-align:center;
  background: linear-gradient(60deg, rgba(84,58,183,1) 0%, rgba(0,172,193,1) 100%);
  color:white;
  }
  .logo {
  width:50px;
  fill:white;
  padding-right:15px;
  display:inline-block;
  vertical-align: middle;
  }
  .inner-header {
  height:65vh;
  width:100%;
  margin: 0;
  padding: 0;
  }
  .flex { /*Flexbox for containers*/
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  }
  .waves {
  position:relative;
  width: 100%;
  height:15vh;
  margin-bottom:-7px; /*Fix for safari gap*/
  min-height:100px;
  max-height:150px;
  }
  .content {
  position:relative;
  height:20vh;
  text-align:center;
  background-color: white;
  }
  /* Animation */
  .parallax > use {
  animation: move-forever 25s cubic-bezier(.55,.5,.45,.5)     infinite;
  }
  .parallax > use:nth-child(1) {
  animation-delay: -2s;
  animation-duration: 7s;
  }
  .parallax > use:nth-child(2) {
  animation-delay: -3s;
  animation-duration: 10s;
  }
  .parallax > use:nth-child(3) {
  animation-delay: -4s;
  animation-duration: 13s;
  }
  .parallax > use:nth-child(4) {
  animation-delay: -5s;
  animation-duration: 20s;
  }
  @keyframes move-forever {
  0% {
  transform: translate3d(-90px,0,0);
  }
  100% {
  transform: translate3d(85px,0,0);
  }
  }
  .progress{
    margin-left:20%;
    margin-right:20%;
    margin-top:2%;
  }
  .file-field.medium .file-path-wrapper {
    height: 3rem; }
  .file-field.medium .file-path-wrapper .file-path {
    height: 2.8rem; }

  .file-field.big-2 .file-path-wrapper {
    height: 3.7rem; }
  .file-field.big-2 .file-path-wrapper .file-path {
    height: 3.5rem; }
  /*Shrinking for mobile*/
  @media (max-width: 768px) {
  .waves {
  height:40px;
  min-height:40px;
  }
  .content {
  height:30vh;
  }
  h1 {
  font-size:24px;
  }
  }
.header
  <br><br><br>
  .progress
    .progress-bar.progress-bar-striped.progress-bar-animated#progressBar( role='progressbar' value='0' max='100' style="width:2%")
  form.md-form(style="margin-left:20%" id= "myform" name="myform" method="post" action="users/uploadFile" enctype='multipart/form-data')
    .form-group
      input(name='csvData', onchange="parseCSV()" id='csvData', class="custom-file-input" type='file')
      <br><br><br>
    
  // Editable table
.card
  h3.card-header.text-center.font-weight-bold.text-uppercase.py-4 List of Employees 
  .card-body
    #table.table-editable
      span.table-add.float-right.mb-3.mr-2
        a.text-success(href='#!')
          i.fas.fa-plus.fa-2x(aria-hidden='true')
      table.table.table-bordered.table-responsive-md.table-striped.text-center(id="data-table")
        thead
          tr
            th.text-center EID
            th.text-center Name
            th.text-center Email
            th.text-center DOB
            th.text-center DOJ
            th.text-center Gender
            th.text-center Relationship
            th.text-center Mobile
        tbody(id="target_div")
          tr
          //  td.pt-3-half(contenteditable='true') 
            td.pt-3-half(contenteditable='true') 
            td.pt-3-half(contenteditable='true') Deepends
            td.pt-3-half(contenteditable='true') Spain
            td.pt-3-half(contenteditable='true') Madrid
            td.pt-3-half
              span.table-up
                a.indigo-text(href='#!')
                  i.fas.fa-long-arrow-alt-up(aria-hidden='true')
              span.table-down
                a.indigo-text(href='#!')
                  i.fas.fa-long-arrow-alt-down(aria-hidden='true')
            td
              span.table-remove
                button.btn.btn-danger.btn-rounded.btn-sm.my-0(type='button') Remove 
          // This is our clonable table line
    button(type='submit' style="margin-left:48%" class="btn btn-danger" onclick ="move()" id='uploadButton' value='Register') Upload <br>
  
  //table(id="target_div" style="border: 10px solid black; width:100%; color:white;")
  //button(style="margin:10px" class="btn btn-danger" type='submit' name='pause' id ="pause" onclick="pauseUpload()" value='Register') Pause <br>
  //button(style="margin:10px" class="btn btn-danger" type='submit' name='terminate' id ="terminate" value='Register') Terminate <br>
  //#loader(style="position: fixed; top:0; left:0; width:10%; height: 10%; background: url('images/loader.gif') center center #efefef")
  div
   // button(style="margin:10px" type='submit'  class="btn btn-info" onclick ="window.location='/users/about'" id='logout' value='Register') Working <br>
    button(style="margin:10px" type='submit' class="btn btn-info" onclick ="window.location='/users/logout'" id='logout' value='Register') Logout <br>
  // Content before waves
  //h1 Simple CSS Waves
  // Waves Container
  div
    svg.waves(xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 24 150 28' preserveAspectRatio='none' shape-rendering='auto')
      defs
        path#gentle-wave(d='M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z')
      g.parallax
        use(xlink:href='#gentle-wave' x='48' y='0' fill='rgba(255,255,255,0.7')
        use(xlink:href='#gentle-wave' x='48' y='3' fill='rgba(255,255,255,0.5)')
        use(xlink:href='#gentle-wave' x='48' y='5' fill='rgba(255,255,255,0.3)')
        use(xlink:href='#gentle-wave' x='48' y='7' fill='#fff')
  // Waves end
// Header ends
// Content starts
.content.flex
  p By Harsh Joshi <br><br><br><br>
 
// Content ends
script.
  var genderList = {
    'male': 'Male',
    'female':'Female'
  };
  var transform = 
  {"tag":"tr", "children":[
            {"tag":"td contenteditable='true' class='pt-3-half' id='eid'","html":"${eid}"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='name'","html":"${name}"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='email'","html":"${email}"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='dob' ","html":"${dob}"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='doj' ","html":"${doj}"},
            {"tag":"td class='pt-3-half' id='gender' ","html":"<select style='width:100%;height:100%'><option value='${gender}' disabled selected>${gender}</option><option value='male'>male</option><option value='female'>female</option></select>"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='rel'","html":"${relationship}"},
            {"tag":"td contenteditable='true' class='pt-3-half' id='mobile'","html":"${mobile}"}
  ]};

  function validateEmail($email) {
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    return emailReg.test( $email );
  }
  
  function move() {
      var elem = document.getElementById("progressBar");
      var width = 1;
      var id = setInterval(frame, 10);
      function frame() {
        if (width >= 100) {
          clearInterval(id);
          i = 0;
        } else {
          width++;
          elem.style.width = width + "%";
        }
      }
    }

  function changeDate(dateString){
    console.log(dateString);
    var dateArr=["","January","February","March","April","May","June","July","August","September","October","November","December"];
    var dateParts = dateString.split("/");
    var dateObject = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]); 
    var month=dateObject.getMonth();
    return dateArr[month+1]+' '+dateParts[0]+', '+dateParts[2];
  }
  function editDOB(){
    document.querySelectorAll('#data-table #dob')
    .forEach(e => e.addEventListener("click", function() {
      // Here, `this` refers to the element the event was hooked on
      console.log($(this).context.firstChild.data);
    }));
  }
  function editDOJ(){
    document.querySelectorAll('#data-table #doj')
    .forEach(e => e.addEventListener("click", function() {
      // Here, `this` refers to the element the event was hooked on
      console.log("DOB");
    }));
  }
  function editEmail(){
    document.querySelectorAll('#data-table #email')
    .forEach(e => e.addEventListener("keydown", function() {
      if(!validateEmail($(this).context.firstChild.data)){
        $("#email").addClass("invalid-input");
      } else{
        $("#email").removeClass("invalid-input");
      }
    }));
  }
  function editGender(){
    document.querySelectorAll('#data-table #gender')
    .forEach(e => e.addEventListener("click", function() {
      validateGender($(this).context.firstChild.data);
    }));
  }
  function parseCSV(){
    let csvFile = $('#csvData').prop('files')[0];  
    let reader = new FileReader();
    reader.readAsText(csvFile);
    jsonFile = [];
    console.log(jsonFile);
    reader.onload = function() {
      try {
          var lines=reader.result.split("\n");
          var headers = lines[0].split(",");
          for(var i=1;i<lines.length-1;i++){
              var built_line = {};
              var cells=lines[i].split(",");
              for(var j=0;j<cells.length;j++){
                  if(cells[j].trim() != ''){
                      built_line[headers[j].trim()]= cells[j].trim();
                  }
                  //console.log(cells[j]);
              }
              jsonFile[i-1] = built_line;
          }            
      }
      catch{
          console.log("Error");   
      }
    for(let i=0;i<jsonFile.length;++i){
       jsonFile[i].dob=changeDate(jsonFile[i].dob);
        jsonFile[i].doj=changeDate(jsonFile[i].doj);
     }
     $('#target_div').html(json2html.transform(jsonFile,transform));
     console.log(jsonFile);
     editDOB();
     editEmail();
    }
  }
  